



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Workshop and lab content for Amazon Aurora PostgreSQL compatible databases. This code will contain a series of templates, instructional guides and sample code to educate users on how to use Amazon Aurora features.">
      
      
        <link rel="canonical" href="https://mylabs.data-builder.com/modules/fastclone/">
      
      
        <meta name="author" content="amazon-aurora-labs-for-mysql@amazon.com">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/aws-favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Fast Cloning - Amazon Aurora Labs for PostgreSQL</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.0284f74d.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../assets/css/custom.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#fast-cloning" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <!--
  Copyright (c) 2016-2018 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Application header -->
<header class="md-header" data-md-component="header">

    <!-- Top-level navigation -->
    <nav class="md-header-nav md-grid">
      <div class="md-flex">

        <!-- Link to home -->
        <div class="md-flex__cell md-flex__cell--shrink">
          <a href="https://aws.amazon.com/"
              title="Amazon Web Services"
              class="md-header-nav__button md-logo">
            
              <img src="../../assets/images/aws_smile_logo.png" width="40" height="24" />
            
          </a>
        </div>

        <!-- Button to toggle drawer -->
        <div class="md-flex__cell md-flex__cell--shrink">
          <label class="md-icon md-icon--menu md-header-nav__button"
              for="__drawer"></label>
        </div>

        <!-- Header title -->
        <div class="md-flex__cell md-flex__cell--stretch">
          <div class="md-flex__ellipsis md-header-nav__title"
              data-md-component="title">
            
              
                <span class="md-header-nav__topic">
                  Amazon Aurora Labs for PostgreSQL
                </span>
                <span class="md-header-nav__topic">
                  Fast Cloning
                </span>
              
            
          </div>
        </div>

        <!-- Button to open search dialogue -->
        <div class="md-flex__cell md-flex__cell--shrink">
          
            
              <label class="md-icon md-icon--search md-header-nav__button"
                  for="__search"></label>

              <!-- Search interface -->
              
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
            
          
        </div>

        <!-- Repository containing source -->
        
      </div>
    </nav>
  </header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." title="Home" class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  <li class="md-tabs__item">
    
      <a href="../" title="Getting Started" class="md-tabs__link">
        Getting Started
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../prerequisites/" title="Modules" class="md-tabs__link md-tabs__link--active">
          Modules
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://mylabs.data-builder.com/" title="Amazon Aurora Labs for PostgreSQL" class="md-nav__button md-logo">
      
        <img src="../../assets/images/aws_smile_logo.png" width="48" height="48">
      
    </a>
    Amazon Aurora Labs for PostgreSQL
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Modules
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Modules
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../prerequisites/" title="Prerequisites" class="md-nav__link">
      Prerequisites
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../create/" title="Creating a New Aurora Cluster" class="md-nav__link">
      Creating a New Aurora Cluster
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../connect/index.md" title="Connecting, Loading Data and Auto Scaling" class="md-nav__link">
      Connecting, Loading Data and Auto Scaling
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Fast Cloning
      </label>
    
    <a href="./" title="Fast Cloning" class="md-nav__link md-nav__link--active">
      Fast Cloning
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-prerequisite" title="1. Prerequisite" class="md-nav__link">
    1. Prerequisite
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-creating-aurora-postgresql-cluster-with-cloudformation" title="2. Creating Aurora PostgreSQL cluster with Cloudformation" class="md-nav__link">
    2. Creating Aurora PostgreSQL cluster with Cloudformation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-retrieving-database-credentials-from-secret-manager" title="2.1 Retrieving Database credentials from Secret Manager" class="md-nav__link">
    2.1 Retrieving Database credentials from Secret Manager
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-cloudformation-resource-chart" title="2.2 Cloudformation Resource chart" class="md-nav__link">
    2.2 Cloudformation Resource chart
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-connecting-to-the-ec2-bastion-instance" title="2.3 Connecting to the EC2 bastion Instance" class="md-nav__link">
    2.3 Connecting to the EC2 bastion Instance
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-setting-up-the-fast-clone-divergence-test" title="3. Setting up the Fast Clone divergence test" class="md-nav__link">
    3. Setting up the Fast Clone divergence test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-creating-and-verifying-performance-impact-of-the-fast-clone" title="4. Creating and verifying performance impact of the Fast Clone" class="md-nav__link">
    4. Creating and verifying performance impact of the Fast Clone
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-running-the-pgbench-workload-on-the-primary-cluster" title="4.1. Running the pgbench workload on the primary cluster" class="md-nav__link">
    4.1. Running the pgbench workload on the primary cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-verify-the-environment-and-run-the-sample-divergence-test" title="4.2 Verify the environment and run the sample divergence test" class="md-nav__link">
    4.2 Verify the environment and run the sample divergence test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-stop-the-sample-data-generation" title="4.3. Stop the sample data generation" class="md-nav__link">
    4.3. Stop the sample data generation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44-create-fast-clone-cluster" title="4.4. Create Fast Clone Cluster" class="md-nav__link">
    4.4. Create Fast Clone Cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#45-start-the-sample-data-divergence-process-on-the-primary-cluster" title="4.5. Start the sample data divergence process on the primary cluster" class="md-nav__link">
    4.5. Start the sample data divergence process on the primary cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#46-verify-the-data-divergence-on-the-clone-cluster" title="4.6. Verify the data divergence on the Clone Cluster" class="md-nav__link">
    4.6. Verify the data divergence on the Clone Cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#47-run-the-pgbench-workload-on-the-clone-cluster" title="4.7. Run the pgbench workload on the Clone Cluster" class="md-nav__link">
    4.7. Run the pgbench workload on the Clone Cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#48-verify-the-pgbench-metrics-on-the-primary-and-the-clone-cluster" title="4.8. Verify the pgbench metrics on the primary and the clone cluster." class="md-nav__link">
    4.8. Verify the pgbench metrics on the primary and the clone cluster.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#49-sample-graph-on-the-fast-clone-performance-impact" title="4.9. Sample graph on the fast clone performance impact" class="md-nav__link">
    4.9. Sample graph on the fast clone performance impact
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../qpm/" title="Query Plan Management" class="md-nav__link">
      Query Plan Management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ccm/" title="Cluster Cache Management" class="md-nav__link">
      Cluster Cache Management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../migration/" title="Oracle to Aurora PostgreSQL migration using DMS and SCT" class="md-nav__link">
      Oracle to Aurora PostgreSQL migration using DMS and SCT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../das/" title="Database Activity Streaming" class="md-nav__link">
      Database Activity Streaming
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-prerequisite" title="1. Prerequisite" class="md-nav__link">
    1. Prerequisite
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-creating-aurora-postgresql-cluster-with-cloudformation" title="2. Creating Aurora PostgreSQL cluster with Cloudformation" class="md-nav__link">
    2. Creating Aurora PostgreSQL cluster with Cloudformation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-retrieving-database-credentials-from-secret-manager" title="2.1 Retrieving Database credentials from Secret Manager" class="md-nav__link">
    2.1 Retrieving Database credentials from Secret Manager
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-cloudformation-resource-chart" title="2.2 Cloudformation Resource chart" class="md-nav__link">
    2.2 Cloudformation Resource chart
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-connecting-to-the-ec2-bastion-instance" title="2.3 Connecting to the EC2 bastion Instance" class="md-nav__link">
    2.3 Connecting to the EC2 bastion Instance
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-setting-up-the-fast-clone-divergence-test" title="3. Setting up the Fast Clone divergence test" class="md-nav__link">
    3. Setting up the Fast Clone divergence test
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-creating-and-verifying-performance-impact-of-the-fast-clone" title="4. Creating and verifying performance impact of the Fast Clone" class="md-nav__link">
    4. Creating and verifying performance impact of the Fast Clone
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-running-the-pgbench-workload-on-the-primary-cluster" title="4.1. Running the pgbench workload on the primary cluster" class="md-nav__link">
    4.1. Running the pgbench workload on the primary cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-verify-the-environment-and-run-the-sample-divergence-test" title="4.2 Verify the environment and run the sample divergence test" class="md-nav__link">
    4.2 Verify the environment and run the sample divergence test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-stop-the-sample-data-generation" title="4.3. Stop the sample data generation" class="md-nav__link">
    4.3. Stop the sample data generation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44-create-fast-clone-cluster" title="4.4. Create Fast Clone Cluster" class="md-nav__link">
    4.4. Create Fast Clone Cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#45-start-the-sample-data-divergence-process-on-the-primary-cluster" title="4.5. Start the sample data divergence process on the primary cluster" class="md-nav__link">
    4.5. Start the sample data divergence process on the primary cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#46-verify-the-data-divergence-on-the-clone-cluster" title="4.6. Verify the data divergence on the Clone Cluster" class="md-nav__link">
    4.6. Verify the data divergence on the Clone Cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#47-run-the-pgbench-workload-on-the-clone-cluster" title="4.7. Run the pgbench workload on the Clone Cluster" class="md-nav__link">
    4.7. Run the pgbench workload on the Clone Cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#48-verify-the-pgbench-metrics-on-the-primary-and-the-clone-cluster" title="4.8. Verify the pgbench metrics on the primary and the clone cluster." class="md-nav__link">
    4.8. Verify the pgbench metrics on the primary and the clone cluster.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#49-sample-graph-on-the-fast-clone-performance-impact" title="4.9. Sample graph on the fast clone performance impact" class="md-nav__link">
    4.9. Sample graph on the fast clone performance impact
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="fast-cloning">Fast Cloning<a class="headerlink" href="#fast-cloning" title="Permanent link">&para;</a></h1>
<h2 id="1-prerequisite">1. Prerequisite<a class="headerlink" href="#1-prerequisite" title="Permanent link">&para;</a></h2>
<p><strong>Create an EC2 Key Pair</strong>: <br> </p>
<p>You will need an EC2 key pair in order to log into the EC2 bastion instance<br></p>
<p>To create a new key pair: </p>
<ol>
<li>Open the EC2 service console</li>
<li>In the left-hand gutter under “Network &amp; Security” click “Key Pairs”</li>
<li>Supply a name and click “Create”</li>
<li>Download or otherwise save the .pem file</li>
</ol>
<h2 id="2-creating-aurora-postgresql-cluster-with-cloudformation">2. Creating Aurora PostgreSQL cluster with Cloudformation<a class="headerlink" href="#2-creating-aurora-postgresql-cluster-with-cloudformation" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="https://us-west-2.console.aws.amazon.com/cloudformation/home?region=us-west-2" target="_blank">Log in to your AWS console and go to the CloudFormation landing page</a></li>
<li>Click create stack, select ‘Specify an Amazon S3 template URL’ and launch the CloudFormation stack from this <a href="https://tinyurl.com/my-cf-template" target="_blank">template</a></li>
<li>Download and save this locally and use upload a template to S3 option and click on “Choose File” option to point to the location where you have saved the template.</li>
<li>Here is a screenshot of the first page – 
<span class="image"><img alt="1-qpm-cf1" src="1-qpm-cf1.png?raw=true" /></span>
<br>
<span class="image"><img alt="1-qpm-cf-2" src="1-qpm-cf-2.png?raw=true" /></span><br>
<span class="image"><img alt="1-qpm-cf-3" src="1-qpm-cf-3.png?raw=true" /></span><br>
<span class="image"><img alt="1-qpm-cf-4" src="1-qpm-cf-4.png?raw=true" /></span><br>
<span class="image"><img alt="1-qpm-cf-5" src="1-qpm-cf-5.png?raw=true" /></span><br>
<span class="image"><img alt="1-qpm-cf-6" src="1-qpm-cf-6.png?raw=true" /></span><br>
<span class="image"><img alt="1-qpm-cf-7" src="1-qpm-cf-7.png?raw=true" /></span><br>
<span class="image"><img alt="1-qpm-cf-8" src="1-qpm-cf-8.png?raw=true" /></span><br>
<span class="image"><img alt="1-qpm-cf-9" src="1-qpm-cf-9.png?raw=true" /></span><br>
<span class="image"><img alt="1-qpm-cf-10" src="1-qpm-cf-10.png?raw=true" /></span><br>
<span class="image"><img alt="1-qpm-cf-11" src="1-qpm-cf-11.png?raw=true" /></span><br></li>
</ol>
<h3 id="21-retrieving-database-credentials-from-secret-manager">2.1 Retrieving Database credentials from Secret Manager<a class="headerlink" href="#21-retrieving-database-credentials-from-secret-manager" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Search for the secret name as shown in the output of the stack and select the secret name.
<span class="image"><img alt="1-qpm-secrets-1" src="1-qpm-secrets-1.png?raw=true" /></span><br> </p>
</li>
<li>
<p>Click on the Retrieve secret value to get the Database user and the password to connect to the Aurora Database.
<span class="image"><img alt="1-qpm-secrets-2" src="1-qpm-secrets-2.png?raw=true" /></span><br>
<span class="image"><img alt="1-qpm-secrets-3" src="1-qpm-secrets-3.png?raw=true" /></span><br>
<span class="image"><img alt="1-qpm-secrets-4" src="1-qpm-secrets-4.png?raw=true" /></span><br></p>
</li>
</ol>
<h3 id="22-cloudformation-resource-chart">2.2 Cloudformation Resource chart<a class="headerlink" href="#22-cloudformation-resource-chart" title="Permanent link">&para;</a></h3>
<p>Please note that the Database names and the Custom Cluster and Database Parameter groups shown below are only for illustrative purpose. Participants are required to use the appropriate resources created from the Cloudformation template.</p>
<p><strong>Please refer the below table for the list of resources and the value</strong></p>
<table>
<thead>
<tr>
<th>Resource name</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cluster Parameter Group</td>
<td>refer CloudFormation template output section and refer the key value “apgcustomclusterparamgroup”</td>
</tr>
<tr>
<td>Database Parameter Group</td>
<td>refer CloudFormation template output section and refer the key value “apgcustomdbparamgroup”</td>
</tr>
<tr>
<td>Cluster Endpoint</td>
<td>refer CloudFormation template output section and refer the key value “clusterEndpoint”</td>
</tr>
<tr>
<td>Reader Endpoint</td>
<td>refer CloudFormation template output section and refer the key value “readerEndpoint”</td>
</tr>
<tr>
<td>DB name</td>
<td>mylab</td>
</tr>
<tr>
<td>DB username</td>
<td>masteruser</td>
</tr>
<tr>
<td>DB password</td>
<td>extract from the secrets Manager as shown above</td>
</tr>
<tr>
<td>bastionEndpoint</td>
<td>refer CloudFormation template output section and refer the key value “bastionEndpoint”</td>
</tr>
</tbody>
</table>
<h3 id="23-connecting-to-the-ec2-bastion-instance">2.3 Connecting to the EC2 bastion Instance<a class="headerlink" href="#23-connecting-to-the-ec2-bastion-instance" title="Permanent link">&para;</a></h3>
<p>We are creating EC2 instance (Amazon Linux AMI-ID ami-0f2176987ee50226e) and bootstrapping the EC2 Instance to have pgbench and sysbench benchmarking tools to be installed.</p>
<div class="codehilite"><pre><span></span><span class="n">ssh</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">keypair</span><span class="p">.</span><span class="n">pem</span><span class="o">&gt;</span> <span class="n">ec2</span><span class="o">-</span><span class="k">user</span><span class="o">@&lt;</span><span class="n">bastionEndpoint</span><span class="o">&gt;</span>
</pre></div>


<p>Replace the [<code>keypair.pem</code>] with the keypair file name input provided to the Cloud formation template. Replace the “bastionEndpoint” with the key value from the output section of the Cloud formation template.</p>
<p>If you need to open an access for your laptop IP specifically, then whitelist your IP, by specifying your IP in the format <code>x.x.x.x/32</code> (<a href=" http://www.whatsmyip.org/" target="_blank">Lookup your IP </a>). If there are any issues in accessing the instance, you can always modify the security group to populate your IP address as My IP as mentioned <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/authorizing-access-to-an-instance.html" target="_blank"> here</a>. </p>
<h2 id="3-setting-up-the-fast-clone-divergence-test">3. Setting up the Fast Clone divergence test<a class="headerlink" href="#3-setting-up-the-fast-clone-divergence-test" title="Permanent link">&para;</a></h2>
<p>The CloudFormation script used to spin up the stack automatically creates following objects in the Database "mylab"</p>
<table>
<thead>
<tr>
<th>Resource name</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>cloneeventtest</td>
<td>Table to store the counter and the timestamp</td>
</tr>
<tr>
<td>statusflag</td>
<td>Table to store the status flag which controls the    start/stop counter</td>
</tr>
<tr>
<td>eventerrormsg</td>
<td>Table to store error messages</td>
</tr>
<tr>
<td>cloneeventproc</td>
<td>Function to add data to the cloneeventtest table based on the start counter flag</td>
</tr>
</tbody>
</table>
<p>In case you need to create these objects manually then you can connect to the Database using psql and run the below commands</p>
<div class="codehilite"><pre><span></span><span class="p">.</span><span class="o">/</span><span class="n">psql</span> <span class="o">-</span><span class="n">h</span> <span class="o">&lt;</span><span class="k">cluster</span><span class="o">-</span><span class="n">endpoint</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">p</span> <span class="o">&lt;</span><span class="n">port</span><span class="o">&gt;-</span> <span class="n">U</span> <span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">d</span> <span class="o">&lt;</span><span class="n">dbname</span><span class="o">&gt;</span>
<span class="p">.</span><span class="o">/</span><span class="n">psql</span> <span class="o">-</span><span class="n">h</span>  <span class="n">labstack</span><span class="o">-</span><span class="k">cluster</span><span class="p">.</span><span class="k">cluster</span><span class="o">-</span><span class="n">xxxxxxxxx</span><span class="p">.</span><span class="n">us</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">2</span><span class="p">.</span><span class="n">rds</span><span class="p">.</span><span class="n">amazonaws</span><span class="p">.</span><span class="n">com</span> <span class="o">-</span><span class="n">p</span> <span class="mi">5432</span> <span class="o">-</span><span class="n">U</span>  <span class="n">masteruser</span> <span class="o">-</span><span class="n">d</span> <span class="n">mylab</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="nv">mylab</span><span class="o">=&gt;</span> <span class="nv">CREATE</span> <span class="nv">TABLE</span> <span class="nv">cloneeventtest</span><span class="ss">(</span>
<span class="nv">mylab</span><span class="ss">(</span><span class="o">&gt;</span>     <span class="nv">counter</span> <span class="nv">smallint</span>,
<span class="nv">mylab</span><span class="ss">(</span><span class="o">&gt;</span>     <span class="nv">seconds_elapsed</span> <span class="nv">int</span>,
<span class="nv">mylab</span><span class="ss">(</span><span class="o">&gt;</span>     <span class="nv">data</span> <span class="nv">TIMESTAMPTZ</span>
<span class="nv">mylab</span><span class="ss">(</span><span class="o">&gt;</span> <span class="ss">)</span>
<span class="nv">mylab</span><span class="o">-&gt;</span>         <span class="nv">WITH</span> <span class="ss">(</span>
<span class="nv">mylab</span><span class="ss">(</span><span class="o">&gt;</span>         <span class="nv">OIDS</span><span class="o">=</span><span class="nv">FALSE</span>
<span class="nv">mylab</span><span class="ss">(</span><span class="o">&gt;</span>         <span class="ss">)</span><span class="c1">;</span>
<span class="nv">CREATE</span> <span class="nv">TABLE</span>
<span class="nv">mylab</span><span class="o">=&gt;</span> <span class="nv">CREATE</span> <span class="nv">TABLE</span> <span class="k">IF</span> <span class="nv">NOT</span> <span class="nv">EXISTS</span> <span class="nv">statusflag</span><span class="ss">(</span>
<span class="nv">mylab</span><span class="ss">(</span><span class="o">&gt;</span>     <span class="nv">delflag</span> <span class="nv">CHARACTER</span> <span class="nv">VARYING</span><span class="ss">(</span><span class="mi">2</span><span class="ss">)</span>
<span class="nv">mylab</span><span class="ss">(</span><span class="o">&gt;</span> <span class="ss">)</span>
<span class="nv">mylab</span><span class="o">-&gt;</span>         <span class="nv">WITH</span> <span class="ss">(</span>
<span class="nv">mylab</span><span class="ss">(</span><span class="o">&gt;</span>         <span class="nv">OIDS</span><span class="o">=</span><span class="nv">FALSE</span>
<span class="nv">mylab</span><span class="ss">(</span><span class="o">&gt;</span>         <span class="ss">)</span><span class="c1">;</span>
<span class="nv">CREATE</span> <span class="nv">TABLE</span>

<span class="nv">mylab</span><span class="o">=&gt;</span> <span class="nv">CREATE</span> <span class="nv">TABLE</span> <span class="k">IF</span> <span class="nv">NOT</span> <span class="nv">EXISTS</span> <span class="nv">eventerrormsg</span><span class="ss">(</span>
<span class="nv">mylab</span><span class="ss">(</span><span class="o">&gt;</span>     <span class="nv">err_msg</span> <span class="nv">CHARACTER</span> <span class="nv">VARYING</span><span class="ss">(</span><span class="mi">2000</span><span class="ss">)</span>,
<span class="nv">mylab</span><span class="ss">(</span><span class="o">&gt;</span>     <span class="nv">time</span> <span class="nv">TIMESTAMPTZ</span>
<span class="nv">mylab</span><span class="ss">(</span><span class="o">&gt;</span> <span class="ss">)</span>
<span class="nv">mylab</span><span class="o">-&gt;</span>         <span class="nv">WITH</span> <span class="ss">(</span>
<span class="nv">mylab</span><span class="ss">(</span><span class="o">&gt;</span>         <span class="nv">OIDS</span><span class="o">=</span><span class="nv">FALSE</span>
<span class="nv">mylab</span><span class="ss">(</span><span class="o">&gt;</span>         <span class="ss">)</span><span class="c1">;</span>
<span class="nv">CREATE</span> <span class="nv">TABLE</span>

<span class="nv">mylab</span><span class="o">=&gt;</span> <span class="nv">INSERT</span> <span class="nv">INTO</span> <span class="nv">statusflag</span> <span class="nv">VALUES</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">N</span><span class="s1">&#39;</span><span class="ss">)</span><span class="c1">;</span>
<span class="nv">INSERT</span> <span class="mi">0</span> <span class="mi">1</span>

<span class="nv">mylab</span><span class="o">=&gt;</span> <span class="nv">CREATE</span> <span class="nv">OR</span> <span class="nv">REPLACE</span> <span class="nv">FUNCTION</span> <span class="nv">cloneeventproc</span><span class="ss">()</span>
<span class="nv">mylab</span><span class="o">-&gt;</span> <span class="nv">RETURNS</span> <span class="nv">void</span>
<span class="nv">mylab</span><span class="o">-&gt;</span> <span class="nv">AS</span>
<span class="nv">mylab</span><span class="o">-&gt;</span> <span class="mh">$B</span><span class="nv">ODY</span>$
<span class="nv">mylab</span>$<span class="o">&gt;</span> <span class="nv">DECLARE</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span>     <span class="nv">l_flag</span> <span class="nv">CHARACTER</span> <span class="nv">VARYING</span><span class="ss">(</span><span class="mi">2</span><span class="ss">)</span><span class="c1">;</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span>     <span class="nv">l_cntr</span> <span class="nv">smallint</span> :<span class="o">=</span> <span class="mi">1</span><span class="c1">;</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span>     <span class="nv">l_sec</span> <span class="nv">int</span> :<span class="o">=</span> <span class="mi">60</span><span class="c1">;</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span>     <span class="nv">l_current_time</span> <span class="nv">TIMESTAMPTZ</span> :<span class="o">=</span><span class="nv">now</span><span class="ss">()</span><span class="c1">;</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span>     <span class="nv">l_errmsg</span> <span class="nv">CHARACTER</span> <span class="nv">VARYING</span><span class="ss">(</span><span class="mi">350</span><span class="ss">)</span><span class="c1">;</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span> <span class="nv">BEGIN</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span>     <span class="k">WHILE</span> <span class="nv">TRUE</span> <span class="k">LOOP</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span>         <span class="nv">SELECT</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span>             <span class="nv">delflag</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span>             <span class="nv">INTO</span> <span class="nv">STRICT</span> <span class="nv">l_flag</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span>             <span class="nv">FROM</span> <span class="nv">statusflag</span><span class="c1">;</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span> 
<span class="nv">mylab</span>$<span class="o">&gt;</span>         <span class="k">IF</span> <span class="nv">l_flag</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">Y</span><span class="s1">&#39;</span> <span class="k">THEN</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span>             <span class="k">EXIT</span><span class="c1">;</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span>         <span class="k">END</span> <span class="k">IF</span><span class="c1">;</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span>         <span class="nv">INSERT</span> <span class="nv">INTO</span> <span class="nv">cloneeventtest</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span>         <span class="nv">VALUES</span> <span class="ss">(</span><span class="nv">l_cntr</span>, <span class="nv">l_sec</span>, <span class="nv">l_current_time</span><span class="ss">)</span><span class="c1">;</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span>         <span class="nv">l_cntr</span> :<span class="o">=</span> <span class="nv">l_cntr</span> <span class="o">+</span> <span class="mi">1</span><span class="c1">;</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span>         <span class="nv">l_sec</span> :<span class="o">=</span> <span class="nv">l_sec</span> <span class="o">+</span> <span class="mi">60</span><span class="c1">;</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span>         <span class="nv">l_current_time</span><span class="o">=</span><span class="nv">l_current_time</span> <span class="o">+</span> <span class="ss">(</span><span class="mi">1</span> <span class="o">||</span><span class="s1">&#39;</span><span class="s"> minutes</span><span class="s1">&#39;</span><span class="ss">)</span>::<span class="nv">interval</span><span class="c1">;</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span>         <span class="nv">PERFORM</span> <span class="nv">pg_sleep</span><span class="ss">(</span><span class="mi">60</span><span class="ss">)</span><span class="c1">;</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span>         
<span class="nv">mylab</span>$<span class="o">&gt;</span>     <span class="k">END</span> <span class="k">LOOP</span><span class="c1">;</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span>     <span class="nv">EXCEPTION</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span>         <span class="nv">WHEN</span> <span class="nv">others</span> <span class="k">THEN</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span>             <span class="nv">INSERT</span> <span class="nv">INTO</span> <span class="nv">eventerrormsg</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span>      <span class="nv">VALUES</span> <span class="ss">(</span><span class="nv">l_errmsg</span>, <span class="nv">now</span><span class="ss">())</span><span class="c1">;  </span>
<span class="nv">mylab</span>$<span class="o">&gt;</span> <span class="nv">commit</span><span class="c1">;     </span>
<span class="nv">mylab</span>$<span class="o">&gt;</span> <span class="k">END</span><span class="c1">;</span>
<span class="nv">mylab</span>$<span class="o">&gt;</span> <span class="mh">$B</span><span class="nv">ODY</span>$
<span class="nv">mylab</span><span class="o">-&gt;</span> <span class="nv">LANGUAGE</span>  <span class="nv">plpgsql</span><span class="c1">;</span>
<span class="nv">CREATE</span> <span class="nv">FUNCTION</span>
</pre></div>


<h2 id="4-creating-and-verifying-performance-impact-of-the-fast-clone">4. Creating and verifying performance impact of the Fast Clone<a class="headerlink" href="#4-creating-and-verifying-performance-impact-of-the-fast-clone" title="Permanent link">&para;</a></h2>
<p>To verify the performance impact of the clone cluster on the primary source cluster we will be performing follow steps</p>
<p>a.  Start the pgbench workload (a PostgreSQL benchmarking tool) to generate a synthetic workload and run benchmarking on the primary cluster for 30 minutes. <br>
b.  Execute the function “cloneeventproc” to start adding sample data on the source cluster.<br>
c.  After 5 minutes or so kick off fast clone cluster creation. The pgbench workload will continue to execute.<br>
d.  The clone cluster should be ready after about 15 minutes or so. Run the same pgbench workload on the clone cluster as the one running on the primary cluster (step #a)<br>
e.  Verify the pgbench Transaction per seconds (TPS) metrics on the primary and the clone cluster.<br>
f.  Verify the output from the sample table “cloneeventtest” on both the primary and the clone cluster to see the data divergence.<br></p>
<h3 id="41-running-the-pgbench-workload-on-the-primary-cluster">4.1. Running the pgbench workload on the primary cluster<a class="headerlink" href="#41-running-the-pgbench-workload-on-the-primary-cluster" title="Permanent link">&para;</a></h3>
<p>Before creating a Fast Clone of the primary cluster, we are going to start pgbench test to measure the Transaction per seconds (TPS) metrics on the primary cluster before the clone creation. </p>
<div class="codehilite"><pre><span></span><span class="n">pgbench</span>  <span class="o">--</span><span class="n">progress</span><span class="o">-</span><span class="n">timestamp</span> <span class="o">-</span><span class="n">M</span> <span class="n">prepared</span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="n">T</span> <span class="mi">1800</span> <span class="o">-</span><span class="n">P</span> <span class="mi">60</span>  <span class="o">-</span><span class="n">c</span> <span class="mi">8</span> <span class="o">-</span><span class="n">j</span> <span class="mi">8</span>  <span class="o">--</span><span class="n">host</span><span class="o">=</span><span class="n">labstack</span><span class="o">-</span><span class="n">cluster</span><span class="p">.</span><span class="n">cluster</span><span class="o">-</span><span class="n">xxxxxxxxx</span><span class="p">.</span><span class="n">us</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mf">2.</span><span class="n">rds</span><span class="p">.</span><span class="n">amazonaws</span><span class="p">.</span><span class="n">com</span> <span class="o">-</span><span class="n">b</span> <span class="n">tpcb</span><span class="o">-</span><span class="n">like</span><span class="mi">@1</span> <span class="o">-</span><span class="n">b</span> <span class="n">select</span><span class="o">-</span><span class="n">only</span><span class="mi">@20</span> <span class="o">--</span><span class="n">username</span><span class="o">=</span><span class="n">masteruser</span> <span class="n">mylab</span><span class="o">&gt;</span> <span class="n">Primary_results</span><span class="p">.</span><span class="n">log</span>
</pre></div>


<h3 id="42-verify-the-environment-and-run-the-sample-divergence-test">4.2 Verify the environment and run the sample divergence test<a class="headerlink" href="#42-verify-the-environment-and-run-the-sample-divergence-test" title="Permanent link">&para;</a></h3>
<p>In order to verify the data divergence on the primary and the clone cluster we will be adding sample data using sample tables and the function created above in step#3.</p>
<p>Verify the status flag is set to ‘N’ and there is no data in the table “cloneeventtest”. Execute the function cloneeventproc() to start adding sample data. This function will add a row to the table “cloneeventtest” every 60 seconds. </p>
<div class="codehilite"><pre><span></span><span class="nv">psql</span> <span class="o">-</span><span class="nv">h</span> <span class="nv">labstack</span><span class="o">-</span><span class="nv">cluster</span>.<span class="nv">cluster</span><span class="o">-</span><span class="nv">cwkjlhbdms9s</span>.<span class="nv">us</span><span class="o">-</span><span class="nv">west</span><span class="o">-</span><span class="mi">2</span>.<span class="nv">rds</span>.<span class="nv">amazonaws</span>.<span class="nv">com</span> <span class="o">-</span><span class="nv">p</span> <span class="mi">5432</span> <span class="o">-</span><span class="nv">U</span> <span class="nv">masteruser</span> <span class="o">-</span><span class="nv">d</span> <span class="nv">mylab</span>
<span class="nv">Password</span> <span class="k">for</span> <span class="nv">user</span> <span class="nv">masteruser</span>: 
<span class="nv">psql</span> <span class="ss">(</span><span class="mi">10</span>.<span class="mi">7</span><span class="ss">)</span>
<span class="nv">Type</span> <span class="s2">&quot;</span><span class="s">help</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="nv">help</span>.

<span class="nv">mylab</span><span class="o">=&gt;</span> <span class="nv">select</span> <span class="o">*</span> <span class="nv">from</span> <span class="nv">statusflag</span><span class="c1">;</span>
 <span class="nv">delflag</span> 
<span class="o">---------</span>
 <span class="nv">N</span>
<span class="ss">(</span><span class="mi">1</span> <span class="nv">row</span><span class="ss">)</span>

<span class="nv">mylab</span><span class="o">=&gt;</span> <span class="nv">select</span> <span class="o">*</span> <span class="nv">from</span> <span class="nv">cloneeventtest</span><span class="c1">;</span>
 <span class="nv">counter</span> <span class="o">|</span> <span class="nv">seconds_elapsed</span> <span class="o">|</span> <span class="nv">data</span> 
<span class="o">---------+-----------------+------</span>
<span class="ss">(</span><span class="mi">0</span> <span class="nv">rows</span><span class="ss">)</span>

<span class="nv">mylab</span><span class="o">=&gt;</span> <span class="nv">select</span> <span class="nv">cloneeventproc</span><span class="ss">()</span><span class="c1">;</span>
 <span class="nv">cloneeventproc</span> 
<span class="o">----------------</span>
</pre></div>


<p>At this time (we call as time “T1”) the pgbench workload is running on the source DB cluster and also, we are adding sample data to the table on the primary cluster every 60 seconds.</p>
<h3 id="43-stop-the-sample-data-generation">4.3. Stop the sample data generation<a class="headerlink" href="#43-stop-the-sample-data-generation" title="Permanent link">&para;</a></h3>
<p>At time (After 5 minutes or so kick off fast clone cluster creation. T1+5 minutes we will stop the function execution by manually resetting the “delflag” column on the table “statusflag” to “Y” from another session (different than the session where we executed the function). The pgbench workload will continue to execute on the primary source cluster</p>
<div class="codehilite"><pre><span></span><span class="nv">From</span> <span class="nv">session</span> <span class="sc">#2</span> 
[<span class="nv">ec2</span><span class="o">-</span><span class="nv">user</span>@<span class="nv">ip</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">0</span><span class="o">-</span><span class="mi">0</span><span class="o">-</span><span class="mi">204</span> <span class="o">~</span>]$ <span class="nv">psql</span> <span class="o">-</span><span class="nv">h</span> <span class="nv">labstack</span><span class="o">-</span><span class="nv">cluster</span>.<span class="nv">cluster</span><span class="o">-</span><span class="nv">xxxxxxxxxx</span>.<span class="nv">us</span><span class="o">-</span><span class="nv">west</span><span class="o">-</span><span class="mi">2</span>.<span class="nv">rds</span>.<span class="nv">amazonaws</span>.<span class="nv">com</span> <span class="o">-</span><span class="nv">p</span> <span class="mi">5432</span> <span class="o">-</span><span class="nv">U</span> <span class="nv">masteruser</span> <span class="o">-</span><span class="nv">d</span> <span class="nv">mylab</span>
<span class="nv">Password</span> <span class="k">for</span> <span class="nv">user</span> <span class="nv">masteruser</span>: 
<span class="nv">psql</span> <span class="ss">(</span><span class="mi">10</span>.<span class="mi">7</span><span class="ss">)</span>
<span class="nv">Type</span> <span class="s2">&quot;</span><span class="s">help</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="nv">help</span>.

<span class="nv">mylab</span><span class="o">=&gt;</span> <span class="nv">update</span> <span class="nv">statusflag</span> <span class="nv">set</span> <span class="nv">delflag</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">Y</span><span class="s1">&#39;</span><span class="c1">;</span>
<span class="nv">UPDATE</span> <span class="mi">1</span>

<span class="nv">Back</span> <span class="nv">to</span> <span class="nv">session</span> <span class="sc">#1</span>
<span class="nv">mylab</span><span class="o">=&gt;</span> <span class="nv">select</span> <span class="nv">cloneeventproc</span><span class="ss">()</span><span class="c1">;</span>
 <span class="nv">cloneeventproc</span> 
<span class="o">----------------</span>

<span class="ss">(</span><span class="mi">1</span> <span class="nv">row</span><span class="ss">)</span>

<span class="nv">mylab</span><span class="o">=&gt;</span> <span class="nv">select</span> <span class="nv">count</span><span class="ss">(</span><span class="o">*</span><span class="ss">)</span> <span class="nv">from</span> <span class="nv">cloneeventtest</span><span class="c1">;</span>
 <span class="nv">count</span> 
<span class="o">-------</span>
     <span class="mi">5</span>
<span class="ss">(</span><span class="mi">1</span> <span class="nv">row</span><span class="ss">)</span>

<span class="nv">mylab</span><span class="o">=&gt;</span> <span class="k">show</span> <span class="nv">timezone</span><span class="c1">;</span>
 <span class="nv">TimeZone</span> 
<span class="o">----------</span>
 <span class="nv">UTC</span>
<span class="ss">(</span><span class="mi">1</span> <span class="nv">row</span><span class="ss">)</span>

<span class="nv">mylab</span><span class="o">=&gt;</span> <span class="nv">SET</span> <span class="nv">timezone</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">America/Los_Angeles</span><span class="s1">&#39;</span><span class="c1">;</span>
<span class="nv">SET</span>
<span class="nv">mylab</span><span class="o">=&gt;</span> <span class="nv">select</span> <span class="o">*</span> <span class="nv">from</span> <span class="nv">cloneeventtest</span><span class="c1">;</span>
 <span class="nv">counter</span> <span class="o">|</span> <span class="nv">seconds_elapsed</span> <span class="o">|</span>             <span class="nv">data</span>              
<span class="o">---------+-----------------+-------------------------------</span>
       <span class="mi">1</span> <span class="o">|</span>              <span class="mi">60</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">20</span> <span class="mi">13</span>:<span class="mi">57</span>:<span class="mi">13</span>.<span class="mi">473963</span><span class="o">-</span><span class="mi">08</span>
       <span class="mi">2</span> <span class="o">|</span>             <span class="mi">120</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">20</span> <span class="mi">13</span>:<span class="mi">58</span>:<span class="mi">13</span>.<span class="mi">473963</span><span class="o">-</span><span class="mi">08</span>
       <span class="mi">3</span> <span class="o">|</span>             <span class="mi">180</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">20</span> <span class="mi">13</span>:<span class="mi">59</span>:<span class="mi">13</span>.<span class="mi">473963</span><span class="o">-</span><span class="mi">08</span>
       <span class="mi">4</span> <span class="o">|</span>             <span class="mi">240</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">20</span> <span class="mi">14</span>:<span class="mi">00</span>:<span class="mi">13</span>.<span class="mi">473963</span><span class="o">-</span><span class="mi">08</span>
       <span class="mi">5</span> <span class="o">|</span>             <span class="mi">300</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">20</span> <span class="mi">14</span>:<span class="mi">01</span>:<span class="mi">13</span>.<span class="mi">473963</span><span class="o">-</span><span class="mi">08</span>
<span class="ss">(</span><span class="mi">5</span> <span class="nv">rows</span><span class="ss">)</span>
</pre></div>


<p><span class="image"><img alt="1-fastclone-1" src="1-fastclone-1.png?raw=true" /></span><br></p>
<h3 id="44-create-fast-clone-cluster">4.4. Create Fast Clone Cluster<a class="headerlink" href="#44-create-fast-clone-cluster" title="Permanent link">&para;</a></h3>
<p>Once the function execution is stopped (after time T1+5 minutes) we will start creating the Fast Clone of the primary cluster. The pgbench workload on the primary will continue on the primary cluster.</p>
<p>will walk you through the process of <a href="https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/Aurora.Managing.Clone.html" target="_blank"> cloning a DB cluster</a>. Cloning creates a separate, independent DB cluster, with a consistent copy of your data set as of the time you cloned it. Database cloning uses a copy-on-write protocol, in which data is copied at the time that data changes, either on the source databases or the clone databases. The two clusters are isolated, and there is no performance impact on the source DB cluster from database operations on the clone, or the other way around.</p>
<p>Following are the steps to configure the Database Fast clone on your Aurora PostgreSQL cluster</p>
<p>a. <a href="https://console.aws.amazon.com/rds/" target="_blank"> Sign in to the AWS Management Console and open the Amazon RDS console</a> . <br> 
b. In the navigation pane, choose Databases and click on the DB identifier with the cluster name you created as a part of the CloudFormation stack.<br>
<span class="image"><img alt="1-fastclone-2" src="1-fastclone-2.png?raw=true" /></span><br></p>
<p>Click on the selected cluster above and look under the section</p>
<p><span class="image"><img alt="1-fastclone-3" src="1-fastclone-3.png?raw=true" /></span><br></p>
<p>c.  Please refer the below table on the input parameters required on next screens  <br></p>
<table>
<thead>
<tr>
<th>Resource name</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>DB Engine</td>
<td>Use default</td>
</tr>
<tr>
<td>Database Instance class</td>
<td>Use the same as the primary DB</td>
</tr>
<tr>
<td>DB Instance Identifier</td>
<td>Labstack-clone</td>
</tr>
<tr>
<td>Database Parameter Group</td>
<td>refer CloudFormation template output section and refer the key value “apgcustomdbparamgroup”</td>
</tr>
<tr>
<td>Cluster Parameter Group</td>
<td>refer CloudFormation template output section and refer the key value “apgcustomclusterparamgroup”</td>
</tr>
<tr>
<td>VPC</td>
<td>refer CloudFormation template output section and refer the key value “vpcid”</td>
</tr>
<tr>
<td>Subnet Group</td>
<td>Use default</td>
</tr>
<tr>
<td>Public accessibility</td>
<td>No</td>
</tr>
<tr>
<td>Availability Zone</td>
<td>Use default</td>
</tr>
<tr>
<td>Security Group</td>
<td>Use default</td>
</tr>
<tr>
<td>Database Port</td>
<td>Use default</td>
</tr>
<tr>
<td>IAM DB authentication</td>
<td>Disable</td>
</tr>
<tr>
<td>Log Exports</td>
<td>Leave it unchecked.</td>
</tr>
<tr>
<td>Auto Minor version upgrade</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<p><span class="image"><img alt="1-fastclone-4" src="1-fastclone-4.png?raw=true" /></span><br>
<span class="image"><img alt="1-fastclone-5" src="1-fastclone-5.png?raw=true" /></span><br>
<span class="image"><img alt="1-fastclone-6" src="1-fastclone-6.png?raw=true" /></span><br>
<span class="image"><img alt="1-fastclone-7" src="1-fastclone-7.png?raw=true" /></span><br>
d. Once you click on the “Create Clone” the status column will show status as “Creating”. <br></p>
<p><span class="image"><img alt="1-fastclone-8" src="1-fastclone-8.png?raw=true" /></span><br></p>
<p>e.  The clone cluster should be ready after about 10-15 minutes or so. The status column will show as “Available” <br></p>
<p><span class="image"><img alt="1-fastclone-9" src="1-fastclone-9.png?raw=true" /></span><br></p>
<h3 id="45-start-the-sample-data-divergence-process-on-the-primary-cluster">4.5. Start the sample data divergence process on the primary cluster<a class="headerlink" href="#45-start-the-sample-data-divergence-process-on-the-primary-cluster" title="Permanent link">&para;</a></h3>
<p>Once the Clone cluster creation process is kicked off, we will start the sample data generation process on the primary cluster. Any sample data added from this point onwards should only be available on the primary cluster and not on the clone cluster.</p>
<div class="codehilite"><pre><span></span><span class="nv">psql</span> <span class="o">-</span><span class="nv">h</span> <span class="nv">labstack</span><span class="o">-</span><span class="nv">cluster</span>.<span class="nv">cluster</span><span class="o">-</span><span class="nv">xxxxxxxx</span>.<span class="nv">us</span><span class="o">-</span><span class="nv">west</span><span class="o">-</span><span class="mi">2</span>.<span class="nv">rds</span>.<span class="nv">amazonaws</span>.<span class="nv">com</span> <span class="o">-</span><span class="nv">p</span> <span class="mi">5432</span> <span class="o">-</span><span class="nv">U</span> <span class="nv">masteruser</span> <span class="o">-</span><span class="nv">d</span> <span class="nv">mylab</span>
<span class="nv">Password</span> <span class="k">for</span> <span class="nv">user</span> <span class="nv">masteruser</span>: 
<span class="nv">psql</span> <span class="ss">(</span><span class="mi">10</span>.<span class="mi">7</span><span class="ss">)</span>
<span class="nv">Type</span> <span class="s2">&quot;</span><span class="s">help</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="nv">help</span>.


<span class="nv">mylab</span><span class="o">=&gt;</span> <span class="nv">truncate</span> <span class="nv">cloneeventtest</span><span class="c1">;</span>
<span class="nv">TRUNCATE</span> <span class="nv">TABLE</span>
<span class="nv">mylab</span><span class="o">=&gt;</span> <span class="nv">update</span> <span class="nv">statusflag</span> <span class="nv">set</span> <span class="nv">delflag</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">N</span><span class="s1">&#39;</span><span class="c1">;</span>
<span class="nv">UPDATE</span> <span class="mi">1</span>
<span class="nv">mylab</span><span class="o">=&gt;</span> 
<span class="nv">mylab</span><span class="o">=&gt;</span> <span class="nv">select</span> <span class="nv">count</span><span class="ss">(</span><span class="o">*</span><span class="ss">)</span> <span class="nv">from</span> <span class="nv">cloneeventtest</span><span class="c1">;</span>
 <span class="nv">count</span> 
<span class="o">-------</span>
     <span class="mi">0</span>
<span class="ss">(</span><span class="mi">1</span> <span class="nv">row</span><span class="ss">)</span>
<span class="nv">mylab</span><span class="o">=&gt;</span> <span class="nv">select</span> <span class="nv">cloneeventproc</span><span class="ss">()</span><span class="c1">;</span>
 <span class="nv">cloneeventproc</span> 
<span class="o">----------------</span>
</pre></div>


<h3 id="46-verify-the-data-divergence-on-the-clone-cluster">4.6. Verify the data divergence on the Clone Cluster<a class="headerlink" href="#46-verify-the-data-divergence-on-the-clone-cluster" title="Permanent link">&para;</a></h3>
<p>clone cluster should be ready after about 15 minutes or so (time T1+~10-15 minutes). To verify the data on the clone cluster, as we started creating the clone cluster approximately at time ~T1+5 minutes. </p>
<p>The table “cloneeventtest” on the clone cluster should have the data point in time to the time when we spin up the clone cluster. </p>
<div class="codehilite"><pre><span></span><span class="nv">From</span> <span class="nv">session</span> <span class="sc">#2</span> 
[<span class="nv">ec2</span><span class="o">-</span><span class="nv">user</span>@<span class="nv">ip</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">0</span><span class="o">-</span><span class="mi">0</span><span class="o">-</span><span class="mi">204</span> <span class="o">~</span>]$ <span class="nv">psql</span> <span class="o">-</span><span class="nv">h</span> <span class="nv">labstack</span><span class="o">-</span><span class="nv">clone</span><span class="o">-</span><span class="nv">cluster</span>.<span class="nv">cluster</span><span class="o">-</span><span class="nv">xxxxxxxxxx</span>.<span class="nv">us</span><span class="o">-</span><span class="nv">west</span><span class="o">-</span><span class="mi">2</span>.<span class="nv">rds</span>.<span class="nv">amazonaws</span>.<span class="nv">com</span> <span class="o">-</span><span class="nv">p</span> <span class="mi">5432</span> <span class="o">-</span><span class="nv">U</span> <span class="nv">masteruser</span> <span class="o">-</span><span class="nv">d</span> <span class="nv">mylab</span>
<span class="nv">Password</span> <span class="k">for</span> <span class="nv">user</span> <span class="nv">masteruser</span>: 
<span class="nv">psql</span> <span class="ss">(</span><span class="mi">10</span>.<span class="mi">7</span><span class="ss">)</span>
<span class="nv">Type</span> <span class="s2">&quot;</span><span class="s">help</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="nv">help</span>.

<span class="nv">mylab</span><span class="o">=&gt;</span> <span class="nv">select</span> <span class="nv">count</span><span class="ss">(</span><span class="o">*</span><span class="ss">)</span> <span class="nv">from</span> <span class="nv">cloneeventtest</span><span class="c1">;</span>
 <span class="nv">count</span> 
<span class="o">-------</span>
     <span class="mi">5</span>
<span class="ss">(</span><span class="mi">1</span> <span class="nv">row</span><span class="ss">)</span>

<span class="nv">mylab</span><span class="o">=&gt;</span> <span class="k">show</span> <span class="nv">timezone</span><span class="c1">;</span>
 <span class="nv">TimeZone</span> 
<span class="o">----------</span>
 <span class="nv">UTC</span>
<span class="ss">(</span><span class="mi">1</span> <span class="nv">row</span><span class="ss">)</span>

<span class="nv">mylab</span><span class="o">=&gt;</span> <span class="nv">SET</span> <span class="nv">timezone</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">America/Los_Angeles</span><span class="s1">&#39;</span><span class="c1">;</span>
<span class="nv">SET</span>
<span class="nv">mylab</span><span class="o">=&gt;</span> <span class="nv">select</span> <span class="o">*</span> <span class="nv">from</span> <span class="nv">cloneeventtest</span><span class="c1">;</span>
 <span class="nv">counter</span> <span class="o">|</span> <span class="nv">seconds_elapsed</span> <span class="o">|</span>             <span class="nv">data</span>              
<span class="o">---------+-----------------+-------------------------------</span>
       <span class="mi">1</span> <span class="o">|</span>              <span class="mi">60</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">20</span> <span class="mi">13</span>:<span class="mi">57</span>:<span class="mi">13</span>.<span class="mi">473963</span><span class="o">-</span><span class="mi">08</span>
       <span class="mi">2</span> <span class="o">|</span>             <span class="mi">120</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">20</span> <span class="mi">13</span>:<span class="mi">58</span>:<span class="mi">13</span>.<span class="mi">473963</span><span class="o">-</span><span class="mi">08</span>
       <span class="mi">3</span> <span class="o">|</span>             <span class="mi">180</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">20</span> <span class="mi">13</span>:<span class="mi">59</span>:<span class="mi">13</span>.<span class="mi">473963</span><span class="o">-</span><span class="mi">08</span>
       <span class="mi">4</span> <span class="o">|</span>             <span class="mi">240</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">20</span> <span class="mi">14</span>:<span class="mi">00</span>:<span class="mi">13</span>.<span class="mi">473963</span><span class="o">-</span><span class="mi">08</span>
       <span class="mi">5</span> <span class="o">|</span>             <span class="mi">300</span> <span class="o">|</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">20</span> <span class="mi">14</span>:<span class="mi">01</span>:<span class="mi">13</span>.<span class="mi">473963</span><span class="o">-</span><span class="mi">08</span>
<span class="ss">(</span><span class="mi">5</span> <span class="nv">rows</span><span class="ss">)</span>
</pre></div>


<p><span class="image"><img alt="1-fastclone-10" src="1-fastclone-10.png?raw=true" /></span><br></p>
<h3 id="47-run-the-pgbench-workload-on-the-clone-cluster">4.7. Run the pgbench workload on the Clone Cluster<a class="headerlink" href="#47-run-the-pgbench-workload-on-the-clone-cluster" title="Permanent link">&para;</a></h3>
<p>We are going to start the same pgbench workload as we did on the primary cluster in step# 4.1. </p>
<div class="codehilite"><pre><span></span><span class="n">pgbench</span>  <span class="o">--</span><span class="n">progress</span><span class="o">-</span><span class="n">timestamp</span> <span class="o">-</span><span class="n">M</span> <span class="n">prepared</span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="n">T</span> <span class="mi">1800</span> <span class="o">-</span><span class="n">P</span> <span class="mi">60</span>  <span class="o">-</span><span class="n">c</span> <span class="mi">8</span> <span class="o">-</span><span class="n">j</span> <span class="mi">8</span>  <span class="o">--</span><span class="n">host</span><span class="o">=</span><span class="n">labstack</span><span class="o">-</span><span class="n">clone</span><span class="o">-</span><span class="n">cluster</span><span class="p">.</span><span class="n">cluster</span><span class="o">-</span><span class="n">xxxxxxxxx</span><span class="p">.</span><span class="n">us</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mf">2.</span><span class="n">rds</span><span class="p">.</span><span class="n">amazonaws</span><span class="p">.</span><span class="n">com</span> <span class="o">-</span><span class="n">b</span> <span class="n">tpcb</span><span class="o">-</span><span class="n">like</span><span class="mi">@1</span> <span class="o">-</span><span class="n">b</span> <span class="n">select</span><span class="o">-</span><span class="n">only</span><span class="mi">@20</span> <span class="o">--</span><span class="n">username</span><span class="o">=</span><span class="n">masteruser</span> <span class="n">mylab</span><span class="o">&gt;</span> <span class="n">clone_results</span><span class="p">.</span><span class="n">log</span>
</pre></div>


<h3 id="48-verify-the-pgbench-metrics-on-the-primary-and-the-clone-cluster">4.8. Verify the pgbench metrics on the primary and the clone cluster.<a class="headerlink" href="#48-verify-the-pgbench-metrics-on-the-primary-and-the-clone-cluster" title="Permanent link">&para;</a></h3>
<p>Once the pgbench workload completed on both the primary and the clone cluster we can verify the TPS metrics from both the cluster by looking at the output file.</p>
<div class="codehilite"><pre><span></span><span class="o">[</span><span class="n">ec2-user@ip-xxxxxxxx ~</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">Primary_results</span><span class="p">.</span><span class="nf">log</span><span class="w"> </span>
<span class="k">transaction</span><span class="w"> </span><span class="nl">type</span><span class="p">:</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">scripts</span><span class="w"></span>
<span class="n">scaling</span><span class="w"> </span><span class="nl">factor</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="w"></span>
<span class="n">query</span><span class="w"> </span><span class="nl">mode</span><span class="p">:</span><span class="w"> </span><span class="n">prepared</span><span class="w"></span>
<span class="n">number</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nl">clients</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="w"></span>
<span class="n">number</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nl">threads</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="w"></span>
<span class="nl">duration</span><span class="p">:</span><span class="w"> </span><span class="mi">1800</span><span class="w"> </span><span class="n">s</span><span class="w"></span>
<span class="n">number</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">transactions</span><span class="w"> </span><span class="n">actually</span><span class="w"> </span><span class="nl">processed</span><span class="p">:</span><span class="w"> </span><span class="mi">19494742</span><span class="w"></span>
<span class="n">latency</span><span class="w"> </span><span class="n">average</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.739</span><span class="w"> </span><span class="n">ms</span><span class="w"></span>
<span class="n">latency</span><span class="w"> </span><span class="n">stddev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.361</span><span class="w"> </span><span class="n">ms</span><span class="w"></span>
<span class="n">tps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10830.345301</span><span class="w"> </span><span class="p">(</span><span class="n">including</span><span class="w"> </span><span class="n">connections</span><span class="w"> </span><span class="n">establishing</span><span class="p">)</span><span class="w"></span>
<span class="n">tps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10830.428982</span><span class="w"> </span><span class="p">(</span><span class="n">excluding</span><span class="w"> </span><span class="n">connections</span><span class="w"> </span><span class="n">establishing</span><span class="p">)</span><span class="w"></span>
<span class="k">SQL</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span><span class="w"> </span><span class="o">&lt;</span><span class="nl">builtin</span><span class="p">:</span><span class="w"> </span><span class="n">TPC</span><span class="o">-</span><span class="n">B</span><span class="w"> </span><span class="p">(</span><span class="n">sort</span><span class="w"> </span><span class="k">of</span><span class="p">)</span><span class="o">&gt;</span><span class="w"></span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nl">weight</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">targets</span><span class="w"> </span><span class="mf">4.8</span><span class="o">%</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">total</span><span class="p">)</span><span class="w"></span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">928533</span><span class="w"> </span><span class="n">transactions</span><span class="w"> </span><span class="p">(</span><span class="mf">4.8</span><span class="o">%</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">total</span><span class="p">,</span><span class="w"> </span><span class="n">tps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">515.848479</span><span class="p">)</span><span class="w"></span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">latency</span><span class="w"> </span><span class="n">average</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">6.228</span><span class="w"> </span><span class="n">ms</span><span class="w"></span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">latency</span><span class="w"> </span><span class="n">stddev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.127</span><span class="w"> </span><span class="n">ms</span><span class="w"></span>
<span class="k">SQL</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="mi">2</span><span class="err">:</span><span class="w"> </span><span class="o">&lt;</span><span class="nl">builtin</span><span class="p">:</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="k">only</span><span class="o">&gt;</span><span class="w"></span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nl">weight</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="p">(</span><span class="n">targets</span><span class="w"> </span><span class="mf">95.2</span><span class="o">%</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">total</span><span class="p">)</span><span class="w"></span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">18561932</span><span class="w"> </span><span class="n">transactions</span><span class="w"> </span><span class="p">(</span><span class="mf">95.2</span><span class="o">%</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">total</span><span class="p">,</span><span class="w"> </span><span class="n">tps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10312.120725</span><span class="p">)</span><span class="w"></span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">latency</span><span class="w"> </span><span class="n">average</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.464</span><span class="w"> </span><span class="n">ms</span><span class="w"></span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">latency</span><span class="w"> </span><span class="n">stddev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.371</span><span class="w"> </span><span class="n">ms</span><span class="w"></span>
</pre></div>


<p><span class="image"><img alt="1-fastclone-11" src="1-fastclone-11.png?raw=true" /></span><br></p>
<div class="codehilite"><pre><span></span><span class="o">[</span><span class="n">ec2-user@ip-10-0-0-204 ~</span><span class="o">]</span><span class="err">$</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">clone_results</span><span class="p">.</span><span class="nf">log</span><span class="w"></span>
<span class="k">transaction</span><span class="w"> </span><span class="nl">type</span><span class="p">:</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">scripts</span><span class="w"></span>
<span class="n">scaling</span><span class="w"> </span><span class="nl">factor</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="w"></span>
<span class="n">query</span><span class="w"> </span><span class="nl">mode</span><span class="p">:</span><span class="w"> </span><span class="n">prepared</span><span class="w"></span>
<span class="n">number</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nl">clients</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="w"></span>
<span class="n">number</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nl">threads</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="w"></span>
<span class="nl">duration</span><span class="p">:</span><span class="w"> </span><span class="mi">1800</span><span class="w"> </span><span class="n">s</span><span class="w"></span>
<span class="n">number</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">transactions</span><span class="w"> </span><span class="n">actually</span><span class="w"> </span><span class="nl">processed</span><span class="p">:</span><span class="w"> </span><span class="mi">19494742</span><span class="w"></span>
<span class="n">latency</span><span class="w"> </span><span class="n">average</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.739</span><span class="w"> </span><span class="n">ms</span><span class="w"></span>
<span class="n">latency</span><span class="w"> </span><span class="n">stddev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.361</span><span class="w"> </span><span class="n">ms</span><span class="w"></span>
<span class="n">tps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10830.345301</span><span class="w"> </span><span class="p">(</span><span class="n">including</span><span class="w"> </span><span class="n">connections</span><span class="w"> </span><span class="n">establishing</span><span class="p">)</span><span class="w"></span>
<span class="n">tps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10830.428982</span><span class="w"> </span><span class="p">(</span><span class="n">excluding</span><span class="w"> </span><span class="n">connections</span><span class="w"> </span><span class="n">establishing</span><span class="p">)</span><span class="w"></span>
<span class="k">SQL</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span><span class="w"> </span><span class="o">&lt;</span><span class="nl">builtin</span><span class="p">:</span><span class="w"> </span><span class="n">TPC</span><span class="o">-</span><span class="n">B</span><span class="w"> </span><span class="p">(</span><span class="n">sort</span><span class="w"> </span><span class="k">of</span><span class="p">)</span><span class="o">&gt;</span><span class="w"></span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nl">weight</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">targets</span><span class="w"> </span><span class="mf">4.8</span><span class="o">%</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">total</span><span class="p">)</span><span class="w"></span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">928533</span><span class="w"> </span><span class="n">transactions</span><span class="w"> </span><span class="p">(</span><span class="mf">4.8</span><span class="o">%</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">total</span><span class="p">,</span><span class="w"> </span><span class="n">tps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">515.848479</span><span class="p">)</span><span class="w"></span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">latency</span><span class="w"> </span><span class="n">average</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">6.228</span><span class="w"> </span><span class="n">ms</span><span class="w"></span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">latency</span><span class="w"> </span><span class="n">stddev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.127</span><span class="w"> </span><span class="n">ms</span><span class="w"></span>
<span class="k">SQL</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="mi">2</span><span class="err">:</span><span class="w"> </span><span class="o">&lt;</span><span class="nl">builtin</span><span class="p">:</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="k">only</span><span class="o">&gt;</span><span class="w"></span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nl">weight</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="p">(</span><span class="n">targets</span><span class="w"> </span><span class="mf">95.2</span><span class="o">%</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">total</span><span class="p">)</span><span class="w"></span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">18561932</span><span class="w"> </span><span class="n">transactions</span><span class="w"> </span><span class="p">(</span><span class="mf">95.2</span><span class="o">%</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">total</span><span class="p">,</span><span class="w"> </span><span class="n">tps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10312.120725</span><span class="p">)</span><span class="w"></span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">latency</span><span class="w"> </span><span class="n">average</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.464</span><span class="w"> </span><span class="n">ms</span><span class="w"></span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">latency</span><span class="w"> </span><span class="n">stddev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.371</span><span class="w"> </span><span class="n">ms</span><span class="w"></span>
</pre></div>


<p><span class="image"><img alt="1-fastclone-12" src="1-fastclone-12.png?raw=true" /></span><br></p>
<h3 id="49-sample-graph-on-the-fast-clone-performance-impact">4.9. Sample graph on the fast clone performance impact<a class="headerlink" href="#49-sample-graph-on-the-fast-clone-performance-impact" title="Permanent link">&para;</a></h3>
<p>Below is the sample comparison slide to show the performance impact of the clone</p>
<p><span class="image"><img alt="1-fastclone-13" src="1-fastclone-13.png?raw=true" /></span><br></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../create/" title="Creating a New Aurora Cluster" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Creating a New Aurora Cluster
              </span>
            </div>
          </a>
        
        
          <a href="../qpm/" title="Query Plan Management" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Query Plan Management
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2019, Amazon Web Services, Inc. or its affiliates. All rights reserved.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://mylabs.data-builder.com/" class="md-footer-social__link fa fa-home"></a>
    
      <a href="https://aws.amazon.com/rds/aurora/postgresql-features/" class="md-footer-social__link fa fa-amazon"></a>
    
      <a href="https://mylabs.data-builder.com/" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>